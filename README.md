# TabEx
Add Chrome-like tab functionality to explorer, replacing Clover and ExTab.

## 📥 下载

**最新版本**: 从 [Releases](../../releases/latest) 页面下载 `TabExplorer.exe`

无需安装Python环境，下载即用！

---

## ✨ 特色功能
✅ 多标签页浏览（每个标签页独立历史记录）
✅ 前进/后退导航（支持浏览历史记录）
✅ 标签页固定（带 📌 图标，开机自动恢复）
✅ 标签页拖拽排序（鼠标拖拽调整标签页顺序，固定标签保持在最左侧）
✅ **全面拖拽支持**（支持从文件资源管理器或左侧目录树拖拽文件夹到标签栏、主窗口、目录树任意位置打开新标签页）
✅ **书签管理增强**（支持文件夹层级、上移/下移、编辑/删除、导入/导出、自动备份恢复）
✅ 面包屑导航（支持点击层级跳转、双击编辑）
✅ 网络路径支持（UNC 路径 \\server\share）
✅ 特殊 shell 路径支持（回收站、桌面、此电脑等）
✅ 左侧目录树（自动展开本地盘符，隐藏网络驱动器，可自由调整宽度，支持拖拽操作）
✅ 双击空白区域智能操作（标签栏空白→新建标签页，文件区空白→返回上级）
✅ **单实例模式**（右键菜单打开文件夹时在已有窗口中打开新标签页，避免启动多个进程）
✅ **强大的搜索功能**（支持文件名、文件内容、文件夹名搜索，搜索历史记录，智能二进制文件过滤，LRU缓存优化）
✅ **🆕 自动监听新Explorer窗口**（类似Clover，新打开的Windows资源管理器窗口会自动嵌入到TabExplorer的标签页中）
✅ **🆕 文件系统自动监控**（文件夹内容变化时自动刷新，从回收站恢复文件即时显示）
✅ **🆕 关闭标签页历史**（防止误操作，Ctrl+Shift+T 恢复关闭的标签页，最多记录10个）
✅ **🆕 智能性能优化**（搜索缓存、批量UI更新、智能双击处理、自动备份恢复、资源清理增强）

---

## 🆕 最近更新（2025-12 / 2026-01）

### 书签与数据管理增强
- **书签导入/导出**：支持JSON格式导出书签，兼容Chrome书签格式导入
- **导入模式选择**：支持替换现有书签或合并到现有书签
- **自动备份恢复**：书签文件保存前自动备份（.bak），文件丢失时自动恢复
- **搜索历史记录**：搜索框支持下拉选择历史搜索关键词，最多保存20条（会话期间有效）

### 文件系统监控
- **实时自动刷新**：监控当前文件夹变化，文件创建/删除/重命名后自动刷新显示
- **智能延迟机制**：500ms延迟避免频繁刷新，多次变化合并为一次刷新
- **回收站恢复支持**：从回收站恢复文件后，对应文件夹自动显示恢复的文件

### 拖拽功能增强
- **全面拖拽支持**：支持从文件资源管理器拖拽文件夹到标签栏空白处、主窗口任意位置打开新标签页
- **左侧目录树拖拽**：支持从文件资源管理器拖拽文件夹到左侧目录树，自动打开新标签页
- **双向拖拽**：支持从左侧目录树拖拽文件夹到标签栏或窗口其他位置打开新标签页
- **智能路径识别**：自动识别本地路径和UNC网络路径，拖拽文件时自动打开其所在文件夹

### 关闭标签页历史
- **防误关闭保护**：关闭标签页时自动保存到历史记录，最多记录10个（会话期间有效）
- **快速恢复**：使用 Ctrl+Shift+T 快捷键快速恢复最近关闭的标签页
- **UI按钮支持**：标签栏右侧提供恢复按钮（↶图标），智能启用/禁用
- **智能状态管理**：有历史记录时按钮启用，无历史时自动禁用
- **完整信息保存**：保存路径、标题和shell类型，恢复时完全还原

### 快捷键提示增强
- **按钮提示优化**：所有按钮的提示信息都添加了对应的快捷键说明
- **一致的交互体验**：后退(Alt+←)、前进(Alt+→)、搜索(Ctrl+F)、新建标签(Ctrl+T)、恢复标签(Ctrl+Shift+T)等

### 界面与交互优化
- **书签栏样式优化**：修复书签菜单悬停时文字不可见的问题，增强视觉体验
- **书签管理增强**：支持右键删除书签、导入/导出、自动备份，删除后UI立即刷新，无多余提示框
- **自定义标题栏**：将"📑 书签管理""⚙️ 设置"与最小化/最大化/关闭按钮放在同一行的顶部标题栏，支持拖动与双击最大化
- **书签栏位置优化**：书签栏固定在标签页上方正确位置（已移除窗口外边框上的重复书签栏）
- **静默操作**：添加/删除书签后不再弹出提示框，直接刷新UI，操作更流畅
- **弹框优化**：设置、书签管理弹框采用模态对话框并移除右上角问号按钮；设置弹框更大更舒适
- **蓝色圆角外边框**：窗口采用蓝色可见外边框（白色内容容器嵌套），更易与其他应用区分
- **无边框拖拽缩放**：支持从窗口边缘/角落拖拽调整大小；鼠标在边缘时自动显示对应的调整大小光标
- **图标支持**：运行时为应用与任务栏添加蓝白主题图标（TE字样）
- **左侧目录树优化**：移除最大宽度限制，支持自由拖动调整宽度（最小150px），支持拖拽操作

### 搜索功能增强
- **搜索历史记录**：下拉框显示最近20条搜索关键词，支持快速重复搜索
- **LRU搜索缓存**：最多缓存50个搜索结果，重复搜索瞬间返回
- **智能文件过滤**：自动跳过二进制文件（exe、dll、图片、视频等），只搜索文本文件内容
- **文本智能检测**：使用黑名单+智能检测，支持自定义文件格式
- **性能优化**：批量UI更新（每50ms处理200个结果），队列限制防止卡死
- **结果限制**：默认最多显示5000个结果，防止UI卡顿
- **状态实时更新**：每100个文件更新一次进度，搜索过程可视化

### 性能与稳定性优化
- **文件系统监控**：使用QFileSystemWatcher实时监控文件夹变化，500ms延迟避免频繁刷新
- **数据备份机制**：配置文件和书签文件保存前自动备份（.bak），文件丢失时自动从备份恢复
- **资源清理增强**：程序退出时正确清理所有定时器、线程和COM对象，防止内存泄漏
- **线程安全**：所有后台线程设置为daemon模式，程序退出时自动清理
- **队列保护**：搜索结果队列限制1000容量，防止内存溢出
- **异常处理完善**：关键操作都有异常捕获和错误日志，提升稳定性
- **Explorer监听优化**：监听频率默认2000ms，可在设置中自定义
- **智能双击处理**：使用双击ID机制和多重检查，准确区分文件夹双击和空白双击
- **延迟保存优化**：书签保存采用500ms延迟机制，避免频繁I/O操作

---

## 🛠️ 运行环境

首次运行前需要双击 `0_install_requirements.bat`，安装必要软件。
然后双击运行 `1_TabEx.bat`。

**开机自启动方式**：将 `1_TabEx.bat` 的快捷方式放到 `shell:startup` 目录

**从源码运行**（Python 3.9+）：
```bash
python TabEx.py
```

---

## 📖 高级功能详解

### 自动监听Explorer窗口

**功能说明**：
类似于Clover的核心功能，TabExplorer可以自动监听系统中新打开的Windows资源管理器窗口，并将其自动嵌入到TabExplorer的标签页中。

**如何使用**：
1. 启动TabExplorer
2. 在菜单栏点击 `⚙️ 设置` → 确保 `监听新Explorer窗口` 选项已勾选（默认启用）
3. 打开任意新的Windows资源管理器窗口（比如通过Win+E快捷键，或双击文件夹）
4. 新打开的资源管理器窗口会被自动关闭，并在TabExplorer中打开一个新的标签页指向该路径

**配置选项**：
- 可以在 `config.json` 中设置 `"enable_explorer_monitor": false` 来禁用此功能
- 可以设置 `"explorer_monitor_interval": 2000` 调整监听频率（毫秒），默认2000ms
- 也可以通过菜单栏的设置选项动态启用/禁用

**工作原理**：
- 后台监听线程定期检测新打开的Explorer窗口（支持CabinetWClass和ExploreWClass窗口类）
- 通过COM接口获取新窗口的当前路径
- 智能识别窗口类型，避免误捕获软件自身窗口
- 在TabExplorer中创建新标签页并导航到该路径
- 自动关闭原Explorer窗口，实现无缝体验
### 智能搜索系统

**搜索能力**：
- **搜索历史记录**：下拉框显示最近20条搜索关键词，方便重复搜索
- **文件名搜索**：快速查找文件和文件夹
- **文件内容搜索**：全文搜索，支持大文件分块读取
- **文件类型过滤**：支持 `*.c,*.h,*.xml` 等格式过滤
- **智能二进制过滤**：自动跳过 exe、dll、图片、视频等二进制文件
- **自定义格式支持**：智能检测任意文本文件（包括无扩展名文件）

**性能优化**：
- **LRU缓存**：最多缓存50个搜索结果，重复搜索立即返回
- **批量更新**：每50ms处理200个结果，界面流畅
- **队列保护**：限制1000个待显示结果，防止内存溢出
- **结果限制**：最多显示5000个结果，超过会有警告提示
- **进度实时显示**：每100个文件更新一次状态

**使用技巧**：
1. 点击搜索框下拉箭头可查看搜索历史，直接选择之前的搜索关键词
2. 搜索大量文件时，建议使用文件类型过滤
3. 只搜索文件名比搜索内容快得多
4. 搜索历史在程序运行期间保留，重启后清空

### 书签导入/导出

**功能说明**：
在书签管理对话框中提供导出和导入功能，方便书签的备份、迁移和共享。

**如何使用**：
1. 点击菜单栏 `📑 书签管理` 打开书签管理对话框
2. 点击底部 `导出书签` 按钮可将当前所有书签导出为JSON文件（带时间戳）
3. 点击 `导入书签` 按钮可选择JSON文件导入：
   - **替换模式**：删除现有书签，完全替换为导入的书签
   - **合并模式**：将导入的书签添加到现有书签末尾

**数据格式**：
- 支持标准JSON格式
- 兼容Chrome书签格式（自动识别和处理 `roots` 层级）
- 导出的文件命名格式：`bookmarks_export_YYYYMMDD_HHMMSS.json`

**自动备份**：
- 每次保存书签时自动创建 `.bak` 备份文件
- 如果 `bookmarks.json` 被误删，程序会自动从 `.bak` 恢复

### 关闭标签页历史

**功能说明**：
为了防止误操作关闭重要的标签页，TabExplorer提供了标签页历史记录功能，可以快速恢复最近关闭的标签页。

**如何使用**：
1. **关闭标签页**：使用关闭按钮或 Ctrl+W 关闭标签页时，该标签页的信息会自动保存到历史记录
2. **恢复标签页**：
   - 使用快捷键 `Ctrl+Shift+T` 恢复最近关闭的标签页
   - 点击标签栏右侧的恢复按钮（↶图标）
3. **按钮状态**：当有关闭历史时，恢复按钮自动启用；无历史时自动禁用

**功能特性**：
- **历史容量**：最多记录10个关闭的标签页（可在代码中配置 `max_closed_tabs_history`）
- **完整还原**：恢复时保留原标签页的路径、标题和shell类型（如回收站、此电脑等）
- **会话有效**：历史记录在程序运行期间保留，重启程序后清空
- **LIFO顺序**：后关闭的标签页先恢复（后进先出）
- **设置选项**：可在设置菜单中启用/禁用 Ctrl+Shift+T 快捷键

**注意事项**：
- 历史记录存储在内存中，不会持久化到磁盘
- 达到10个上限后，最早的记录会被自动移除
- 固定的标签页关闭后同样可以恢复

### 文件系统自动监控

**功能说明**：
TabExplorer会自动监控当前打开文件夹的内容变化，任何文件或文件夹的创建、删除、重命名操作都会触发自动刷新。

**典型应用场景**：
- 从回收站恢复文件：恢复后立即在对应标签页显示
- 使用其他程序创建/删除文件：TabExplorer立即同步显示
- 文件下载完成：下载文件夹自动刷新显示新文件

**工作原理**：
- 使用 Qt 的 `QFileSystemWatcher` 监控文件系统变化
- 采用500ms延迟刷新机制，避免短时间内多次变化导致频繁刷新
- 只监控真实文件系统路径，shell特殊路径（如回收站）不监控
- 切换到新文件夹时自动更新监控目标

**注意事项**：
- 文件监控在后台自动运行，无需手动配置
- 监控不影响性能，采用事件驱动机制
- 网络路径（UNC）同样支持监控

---

**开发环境**：Python 3.9.6




